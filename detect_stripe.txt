
	縞判定フィルタ  ver 0.20


【概要】

　何となくインターレース縞の有無を判定するフィルタです。
　周期が微妙に一定ではない24fpsソースの周期ズレの検出にお使いください。

　本フィルタの処理自体は雑なこともあって割と高速なつもりですが、周期ズレを検出す
　るとなるとかなりのフレーム数の走査が必要になるため、ある程度の時間がかかるのを
　覚悟する必要があります。


【動作環境】

　version 0.99i4以降のAviUtlで動作します。マルチスレッドに対応しています。
　SSE2命令を用いるため、CPUがSSE2に対応している必要があります。


【インストール】

　aviutl.exeのあるフォルダ、またはaviutl.exeのあるフォルダに作られたpluginsフォ
　ルダの中にdetect_stripe.aufを置いてください。


【使用方法】

　ほぼ周期一定24fpsなソースを手動でインターレース解除する際に、周期ズレを検出す
　るためのフィルタです。自動でインターレース解除を行う場合は、本フィルタは必要無
　いと思われます。

　本フィルタは、画像を32x32ピクセルのブロックに分けてブロックごとに縞の有無を判
　定し、縞が検出されたブロックの分布に応じて全体としての縞判定を行います。
　縞の検出しやすさは、「検出閾値」及び「判定基準」で調節します。
　縞が検出された場合は設定ウィンドウ名に [縞検出] と表示されます。

　インタレ解除フィルタの設定が出来たら、「走査」または「全走査」ボタンを押すこと
　で、縞の検出が始まります。「走査」は縞が検出された時点で走査を終了し、「全走査」
　は縞が検出されたフレームをマークフレームに設定し、最後まで走査を行います。

　なお、本フィルタは出力時には処理を行わないので、本フィルタを常用する場合は有効
　のままにしておくことも可能です。


【設定項目】

　○ 検出閾値

　　数値が小さいほど縞を検出しやすく、数値が大きいほど縞を検出しません。
　　数値が小さいと、インターレース縞でないノイズを拾う可能性も高くなります。
　　フィーリングな項目ですが、ソースに合わせて適当に調節してください。

　○ 判定基準

　　縞を検出したブロックが、任意の3x3ブロック内に判定基準数以上存在した場合、全
　　体として縞を検出したという判定を行います。
　　ノイズを誤判定しないために、2以上に設定するのが良いかと思います。

　○ 輝度のみで判定

　　縞を判定する際に、輝度の情報のみを参照するか、輝度に加えて色差の情報も参照す
　　るかどうかを選択します。
　　正常にインターレース解除が行われていても、ソースによっては色差に縞が発生して
　　しまうことがあるようなので、誤検出を防ぐためデフォルトでは有効にしています。
　　なお、処理速度に差はほとんどありません。

　○ 縞検出部分を反転する

　　縞を検出したブロックをネガポジ反転して表示します。

　○ 走査

　　現在表示されている次のフレームから走査を開始し、縞が検出された時点で走査を終
　　了します。走査を途中で中止することも可能です。
　　表示される残り時間は、選択終了フレームまでの推定処理時間です。

　○ 全走査

　　走査とほぼ同じですが、こちらは現在のフレームから走査を開始し、縞が検出された
　　フレームをマークフレームに設定して、途中で中止せずに最後まで走査を行います。

　※ 走査・全走査について

　　いずれも走査は選択フレームの範囲内でのみ行います。
　　また、走査中にプロファイルが切り替わった場合、プロファイルが切り替わっても本
　　フィルタが有効な場合は走査を継続し、本フィルタが無効になる場合はそのフレーム
　　で走査を中止します。


【既知の問題とか】

　テキトーな作りのため、こちらで把握できているだけでも不具合がいくつかありますが、
　あんまり修正する気は無いです。

　・走査終了時の画像がおかしい。
　　→ 原因が分からないのですが、判定は正常に行われているようなので気にしないで
　　　 頂けると幸いです。相性の悪いフィルタが存在するようで、特定のフィルタを無
　　　 効にするとこの現象が解消する場合があります。

　・(全)走査ボタンを押しても走査が開始されない。
　　→ 本フィルタが有効かどうか、また選択フレーム範囲を確認してください。
　　　 特に選択フレーム範囲については、走査中になぜか選択フレームが勝手に変更さ
　　　 れてしまうことがあるようです。

　・走査中にAviUtlを最小化したあと復元すると、設定ウィンドウ等が表示されない。
　　→ AviUtlのツールバーを操作して、再度表示することはできます。また、本フィル
　　　 タを無効にすれば走査は中止されます。走査中の最小化は非推奨です。

　・走査中にAviUtlを終了すると異常終了する。
　　→ 走査を中止してから終了してください。

　その他、仕様だとは言えなそうな不具合を発見した場合は、報告頂ければ修正できるか
　もしれません。


【免責とか】

　本プラグイン及びソースコードは、改変したプラグインの公開などを含め自由に利用し
　て頂いて構いませんが、それらの利用によって生じたいかなる結果について、作者は責
　任を負いません。ただし、私のウェブページが閲覧不能になった場合などを除いては、
　私が配布しているものと完全に同一なプラグインの再配布はご遠慮下さい。
　バグ報告・要望などがございましたら、気軽に連絡くださるようお願い致します。


【更新履歴】

ver 0.20 (11/08/08)
	輝度のみを参照した判定を行えるようにした。
	走査中のプロファイルの切り替えに対応した。
	ブロック境界に輪郭がある場合に、誤検出することがあったのを修正。
	縞検出部分を反転する処理を行う順序に問題があったのを修正。
	全走査だけでなく、走査でも残り時間を表示するようにした。
	走査終了時にサウンドを鳴らすようにした。
	パラメータを若干調整、またデフォルトパラメータを変更した。
	その他雑多な挙動修正。
	msvcr100.dllに依存しないようにした。
	ソースコードをちょっとだけマシに。

ver 0.10 (11/06/12)
	初版公開。



http://www.geocities.jp/w_bean17/
oinari17@gmail.com
